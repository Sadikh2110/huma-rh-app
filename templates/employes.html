{% extends "base.html" %}
{% block title %}Liste des employés - HUMA-RH{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-people"></i> Liste des employés</h2>
    <div>
        <a href="{{ url_for('employees.export_csv') }}" class="btn btn-outline-success btn-sm">
            <i class="bi bi-filetype-csv"></i> CSV
        </a>
        <a href="{{ url_for('employees.export_excel') }}" class="btn btn-outline-success btn-sm">
            <i class="bi bi-file-earmark-excel"></i> Excel
        </a>
    </div>
</div>

<!-- Stats rapides -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card bg-primary text-white">
            <div class="card-body">
                <h5>{{ total_employes }} employés</h5>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card bg-success text-white">
            <div class="card-body">
                <h5>Salaire moyen: {{ "%.2f"|format(salaire_moyen) }} €</h5>
            </div>
        </div>
    </div>
</div>

<!-- Filtres -->
<div class="card mb-4">
    <div class="card-body">
        <form method="GET" class="row g-3">
            <div class="col-md-4">
                <input type="text" name="recherche" class="form-control" placeholder="Rechercher..." value="{{ recherche }}">
            </div>
            <div class="col-md-3">
                <select name="departement" class="form-select">
                    <option value="">Tous les départements</option>
                    {% for dept in departements %}
                    <option value="{{ dept }}" {% if departement == dept %}selected{% endif %}>{{ dept }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <input type="number" name="salaire_min" class="form-control" placeholder="Salaire min" value="{{ salaire_min }}">
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">Filtrer</button>
            </div>
        </form>
    </div>
</div>

<!-- Tableau -->
<div class="card">
    <div class="table-responsive">
        <table class="table table-hover mb-0">
            <thead class="table-light">
                <tr>
                    <th>Nom</th>
                    <th>Email</th>
                    <th>Département</th>
                    <th>Poste</th>
                    <th>Salaire</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                <tr>
                    <td><strong>{{ emp.nom }}</strong> {{ emp.prenom }}</td>
                    <td>{{ emp.email }}</td>
                    <td><span class="badge bg-secondary">{{ emp.departement or '-' }}</span></td>
                    <td>{{ emp.poste }}</td>
                    <td>{{ "%.2f"|format(emp.salaire) }} €</td>
                    <td>
                        <a href="{{ url_for('employees.historique', id=emp.id) }}" class="btn btn-sm btn-outline-info" title="Historique">
                            <i class="bi bi-clock-history"></i>
                        </a>
                        {% if current_user.can_edit() %}
                        <a href="{{ url_for('employees.modifier', id=emp.id) }}" class="btn btn-sm btn-outline-primary">
                            <i class="bi bi-pencil"></i>
                        </a>
                        <form action="{{ url_for('employees.supprimer', id=emp.id) }}" method="POST" class="d-inline" 
                              onsubmit="return confirmDelete('{{ emp.prenom }} {{ emp.nom }}')">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted py-4">Aucun employé trouvé</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
{% if pagination.pages > 1 %}
<nav class="mt-4">
    <ul class="pagination justify-content-center">
        {% if pagination.has_prev %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('employees.liste', page=pagination.prev_num, recherche=recherche, departement=departement, salaire_min=salaire_min) }}">Précédent</a>
        </li>
        {% endif %}
        
        {% for page_num in pagination.iter_pages() %}
            {% if page_num %}
            <li class="page-item {% if page_num == pagination.page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('employees.liste', page=page_num, recherche=recherche, departement=departement, salaire_min=salaire_min) }}">{{ page_num }}</a>
            </li>
            {% else %}
            <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
        {% endfor %}
        
        {% if pagination.has_next %}
        <li class="page-item">
            <a class="page-link" href="{{ url_for('employees.liste', page=pagination.next_num, recherche=recherche, departement=departement, salaire_min=salaire_min) }}">Suivant</a>
        </li>
        {% endif %}
    </ul>
</nav>
{% endif %}
{% endblock %}