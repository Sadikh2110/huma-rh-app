<!DOCTYPE html>
<html>
<head>
    <title>ğŸ“Š Dashboard - HUMA-RH</title>
    <style>
        body{font-family:Arial,sans-serif;margin:20px;background:#f5f5f5;}
        .container{max-width:1200px;margin:0 auto;}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px;margin:20px 0;}
        .stat-card{background:white;padding:25px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);text-align:center;}
        .stat-number{font-size:2.5em;font-weight:bold;color:#4CAF50;margin:10px 0;}
        .stat-label{font-size:0.9em;color:#666;text-transform:uppercase;letter-spacing:1px;}
        .dept-table{width:100%;border-collapse:collapse;margin:20px 0;background:white;border-radius:8px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
        th,td{padding:15px;text-align:left;border-bottom:1px solid #eee;}
        th{background:#4CAF50;color:white;}
        .top-salaires{background:white;padding:20px;border-radius:12px;margin:20px 0;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
        .btn{padding:12px 24px;background:#2196F3;color:white;text-decoration:none;border-radius:6px;display:inline-block;margin:5px;}
        h1{text-align:center;color:#333;margin-bottom:10px;}
        .back-btn{background:#666;}
        .evolution{background:#e3f2fd;padding:20px;border-radius:8px;margin:20px 0;}
        .highlight{background:#fff3cd;padding:15px;border-radius:8px;border-left:4px solid #ffc107;}
    </style>
</head>
<body>
<body>
    <!-- MESSAGES FLASH -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div style="padding:15px;margin:20px;background:#d4edda;color:#155724;border-radius:8px;border-left:4px solid #28a745;">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- BARRE NAVIGATION + CONNEXION -->
    <div style="background:#4CAF50;color:white;padding:15px;text-align:center;">
        {% if session.user %}
            <span>ğŸ‘‹ Bonjour, {{ session.user|upper }} !</span>
            <a href="/logout" style="color:white;margin-left:20px;padding:8px 16px;background:#f44336;border-radius:4px;text-decoration:none;">âŒ DÃ©connexion</a>
        {% else %}
            <a href="/login" style="color:white;padding:8px 16px;background:#2196F3;border-radius:4px;text-decoration:none;">ğŸ” Connexion</a>
        {% endif %}
    </div>

{% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
            <div style="padding:15px;margin:20px;background:#d4edda;color:#155724;border-radius:8px;border-left:4px solid #28a745;">
                {{ message }}
            </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    <div class="container">
        <h1>ğŸ“Š Dashboard Statistiques RH</h1>
        <a href="/" class="btn back-btn">ğŸ  Accueil</a>
        <a href="/employes" class="btn">ğŸ“‹ EmployÃ©s</a>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">{{ total_employes }}</div>
                <div class="stat-label">ğŸ‘¥ Total EmployÃ©s</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ "%.0f"|format(salaire_moyen) }}â‚¬</div>
                <div class="stat-label">ğŸ’° Salaire Moyen</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ "%.0f"|format(salaire_total) }}â‚¬</div>
                <div class="stat-label">ğŸ’ Masse Salariale</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ "%.0f"|format(salaire_median) }}â‚¬</div>
                <div class="stat-label">ğŸ“Š Salaire MÃ©dian</div>
            </div>
        </div>

        <div class="highlight">
            <h3>ğŸ† TOP 5 SALAIRES</h3>
            {% for employe in top_salaires %}
            <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #eee;">
                <span>{{ employe.prenom }} {{ employe.nom }} - {{ employe.poste }}</span>
                <strong style="color:#4CAF50;">{{ "%.0f"|format(employe.salaire) }}â‚¬</strong>
            </div>
            {% endfor %}
        </div>

        <h3>ğŸ“ˆ RÃ©partition par DÃ©partement</h3>
        <table class="dept-table">
            <tr>
                <th>DÃ©partement</th>
                <th>Effectif</th>
                <th>Salaire Moyen</th>
                <th>Masse Salariale</th>
            </tr>
            {% for dept in depts %}
            <tr>
                <td><strong>{{ dept.departement }}</strong></td>
                <td>{{ dept.count }}</td>
                <td>{{ "%.0f"|format(dept.avg_salaire) }}â‚¬</td>
                <td>{{ "%.0f"|format(dept.total_salaire) }}â‚¬</td>
            </tr>
            {% endfor %}
        </table>

        {% if evolution %}
        <div class="evolution">
            <h3>ğŸ“… Ã‰volution des Embauches</h3>
            <table class="dept-table" style="margin:0;">
                {% for annee in evolution %}
                <tr>
                    <td><strong>{{ annee.annee }}</strong></td>
                    <td>{{ annee.embauches }} embauches</td>
                    <td>{{ "%.0f"|format(annee.salaire_moyen) }}â‚¬ moyen</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
</body>
</html>
